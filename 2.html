<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>医学在线刷题软件</title>
  <!-- 引入 Vue 3 的 CDN 链接 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f0f2f5;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      box-sizing: border-box;
    }
    #app {
      max-width: 1000px;
      width: 100%;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 30px;
      box-sizing: border-box;
      margin-top: 20px;
    }
    /* 顶部头部与操作区 */
    .app-header {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 25px;
    }
    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    .header-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    /* 分类与题目列表容器 - 左右布局 */
    .question-nav {
      display: flex;
      gap: 20px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }
    /* 分类筛选栏 - 新增折叠样式 */
    .category-list {
      min-width: 200px;
      width: 22%;
      border: 1px solid #eee;
      border-radius: 6px;
      padding: 15px;
      box-sizing: border-box;
    }
    .category-title {
      font-size: 1.1em;
      font-weight: 600;
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 1px solid #eee;
    }
    .category-item {
      padding: 10px 8px;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 8px;
      transition: all 0.2s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .category-item:hover {
      background-color: #f9f9f9;
    }
    .category-item.active {
      background-color: #e3f2fd;
      color: #007bff;
      font-weight: 500;
    }
    /* 折叠/展开图标样式 */
    .collapse-icon {
      font-size: 0.8em;
      transition: transform 0.2s ease;
    }
    .collapse-icon.rotate {
      transform: rotate(90deg);
    }
    /* 单元二级分类样式 */
    .sub-category-wrap {
      margin-left: 8px;
      margin-bottom: 8px;
    }
    .sub-category {
      padding: 10px 8px;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 5px;
      font-size: 0.95em;
      transition: all 0.2s ease;
    }
    .sub-category:hover {
      background-color: #f9f9f9;
    }
    .sub-category.active {
      background-color: #e3f2fd;
      color: #007bff;
      font-weight: 500;
    }
    /* 题目列表栏 */
    .question-list {
      flex: 1;
      border: 1px solid #eee;
      border-radius: 6px;
      padding: 15px;
      box-sizing: border-box;
      max-height: 200px;
      overflow-y: auto;
    }
    .question-list-title {
      font-size: 1.1em;
      font-weight: 600;
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .question-list-count {
      font-size: 0.9em;
      font-weight: 400;
      color: #666;
    }
    .question-item {
      padding: 10px 8px;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.2s ease;
    }
    .question-item:hover {
      background-color: #f9f9f9;
    }
    .question-item.active {
      background-color: #e3f2fd;
      border-left: 3px solid #007bff;
    }
    .question-item.collected {
      color: #dc3545;
    }
    .question-item-finished {
      color: #4caf50;
      font-size: 0.9em;
    }
    .question-item-info {
      font-size: 0.85em;
      color: #999;
    }
    /* 答题区样式 */
    .question-container {
      margin-bottom: 25px;
    }
    .question-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      font-size: 0.9em;
      color: #666;
      margin-bottom: 10px;
    }
    .question-title {
      font-size: 1.4em;
      color: #333;
      line-height: 1.6;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
      gap: 10px;
    }
    .options-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 15px;
    }
    .option-item {
      display: flex;
      align-items: flex-start;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      line-height: 1.5;
    }
    .option-item:hover {
      background-color: #f9f9f9;
      border-color: #007bff;
    }
    .option-item.selected {
      background-color: #e3f2fd;
      border-color: #007bff;
    }
    .option-item.correct {
      background-color: #e8f5e9;
      border-color: #4caf50;
    }
    .option-item.incorrect {
      background-color: #ffebee;
      border-color: #f44336;
    }
    .option-input {
      margin-right: 12px;
      margin-top: 4px;
      cursor: pointer;
    }
    .option-label {
      flex-grow: 1;
      cursor: pointer;
    }
    .controls {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin-top: 20px;
    }
    button {
      padding: 10px 20px;
      font-size: 1em;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .submit-btn {
      background-color: #007bff;
      color: white;
    }
    .submit-btn:hover:not(:disabled) {
      background-color: #0056b3;
    }
    .submit-btn:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    .next-btn {
      background-color: #28a745;
      color: white;
    }
    .next-btn:hover {
      background-color: #218838;
    }
    .next-btn:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    .collect-btn {
      background-color: #ffc107;
      color: #333;
    }
    .collect-btn:hover {
      background-color: #e0a800;
    }
    .collect-btn.collected {
      background-color: #dc3545;
      color: white;
    }
    .reset-btn {
      background-color: #6c757d;
      color: white;
    }
    .reset-btn:hover {
      background-color: #5a6268;
    }
    .collect-list-btn {
      background-color: #17a2b8;
      color: white;
    }
    .collect-list-btn:hover {
      background-color: #138496;
    }
    .result-message {
      margin-top: 15px;
      padding: 12px;
      border-radius: 4px;
      font-weight: bold;
      font-size: 1.05em;
    }
    .result-correct {
      color: #4caf50;
      background-color: #f1f8e9;
      border: 1px solid #c8e6c9;
    }
    .result-incorrect {
      color: #f44336;
      background-color: #ffebee;
      border: 1px solid #ffcdd2;
    }
    .analysis {
      margin-top: 15px;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 6px;
      line-height: 1.6;
    }
    .analysis-title {
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
    }
    .analysis-content {
      color: #444;
    }
    .discuss {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px dashed #ddd;
      color: #666;
      font-size: 0.95em;
    }
    .progress {
      text-align: right;
      color: #666;
      margin-bottom: 10px;
      font-size: 0.95em;
    }
    /* 弹窗样式 */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background-color: white;
      border-radius: 10px;
      padding: 30px;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
    }
    .close-btn {
      background-color: #dc3545;
      color: white;
      padding: 8px 16px;
      font-size: 0.9em;
    }
    .collect-item {
      padding: 15px;
      border: 1px solid #eee;
      border-radius: 6px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      line-height: 1.5;
    }
    .collect-item:hover {
      background-color: #f8f9fa;
      border-color: #007bff;
    }
    .collect-item-meta {
      font-size: 0.85em;
      color: #999;
      margin-top: 5px;
    }
    .back-btn {
      background-color: #6c757d;
      color: white;
      margin-top: 20px;
    }
    /* 空状态样式 */
    .empty-state {
      text-align: center;
      color: #666;
      padding: 20px 0;
      font-size: 0.95em;
    }
    /* 适配移动端 */
    @media (max-width: 768px) {
      .question-nav {
        flex-direction: column;
      }
      .category-list {
        width: 100%;
      }
      .question-title {
        font-size: 1.2em;
      }
      button {
        padding: 8px 16px;
        font-size: 0.95em;
      }
      .app-header {
        gap: 10px;
      }
      .question-meta {
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="app-header">
      <div class="header-top">
        <h1>医学在线刷题</h1>
        <div class="header-actions">
          <button @click="showCollectList" class="collect-list-btn">我的收藏</button>
          <button @click="resetProgress" class="reset-btn">重置进度</button>
        </div>
      </div>
      <div class="progress">
        当前分类：{{ activeCategoryName }} | 第 {{ currentQuestionIndex + 1 }} 题 / 共 {{ filterQuestions.length }} 题
      </div>
    </div>

    <!-- 题目分类 + 题目列表 导航区 -->
    <div class="question-nav">
      <!-- 分类筛选：科目+单元二级分类（新增折叠功能） -->
      <div class="category-list">
        <div class="category-title">题目分类</div>
        <!-- 全部题目 -->
        <div 
          class="category-item"
          :class="{ active: activeCategory === 'all' }"
          @click="switchCategory('all')"
        >
          <span>全部题目 ({{ questions.length }})</span>
        </div>
        <!-- 科目一级分类（可折叠） -->
        <div v-for="(subject, key) in subjectCategories" :key="key">
          <div 
            class="category-item"
            :class="{ active: activeCategory === key && activeUnit === 'all' }"
            @click="toggleCollapse(key)"
          >
            <span>{{ key }} ({{ subject.length }})</span>
            <!-- 折叠/展开图标 -->
            <span class="collapse-icon" :class="{ rotate: collapseStatus[key] }">▶</span>
          </div>
          <!-- 单元二级分类（根据折叠状态显示/隐藏） -->
          <div v-show="collapseStatus[key]" class="sub-category-wrap">
            <div 
              v-for="unit in subject" 
              :key="unit"
              class="sub-category"
              :class="{ active: activeCategory === key && activeUnit === unit }"
              @click="switchCategory(key, unit)"
            >
              {{ unit }}
            </div>
          </div>
        </div>
      </div>

      <!-- 题目列表 -->
      <div class="question-list">
        <div class="question-list-title">
          题目列表
          <span class="question-list-count">共 {{ filterQuestions.length }} 题</span>
        </div>
        <div v-if="filterQuestions.length === 0" class="empty-state">
          该分类暂无题目
        </div>
        <div 
          v-else
          v-for="(q, index) in filterQuestions" 
          :key="q.name"
          class="question-item"
          :class="{
            active: currentQuestion?.name === q.name,
            collected: isQuestionCollected(q.name)
          }"
          @click="goToQuestion(index)"
        >
          <div>
            <span>{{ q.mode }} 第{{ q.numb }}题</span>
            <div class="question-item-info">{{ q.test.substring(0, 25) }}{{ q.test.length > 25 ? '...' : '' }}</div>
          </div>
          <span v-if="isQuestionFinished(q.name)" class="question-item-finished">已完成</span>
        </div>
      </div>
    </div>

    <!-- 核心答题区 -->
    <div class="question-container" v-if="currentQuestion && !showCollectModal">
      <!-- 题目元信息：科目、单元、题型 -->
      <div class="question-meta">
        <span>科目：{{ currentQuestion.cls }}</span>
        <span>单元：{{ currentQuestion.unit }}</span>
        <span>题型：{{ currentQuestion.mode }}</span>
        <span>题号：{{ currentQuestion.numb }}/{{ currentQuestion.all_numb }}</span>
      </div>
      <!-- 题干 -->
      <div class="question-title">
        <span>{{ currentQuestion.test }}</span>
        <button 
          @click="toggleCollect" 
          class="collect-btn"
          :class="{ collected: isCollected }"
        >
          {{ isCollected ? '取消收藏' : '收藏题目' }}
        </button>
      </div>
      <!-- 选项 -->
      <div class="options-container">
        <label 
          v-for="(option, index) in currentQuestion.option" 
          :key="index"
          class="option-item"
          :class="{
            'selected': selectedOption === getOptionKey(option),
            'correct': showResult && getOptionKey(option) === currentQuestion.answer,
            'incorrect': showResult && selectedOption === getOptionKey(option) && selectedOption !== currentQuestion.answer
          }"
        >
          <input
            type="radio"
            :value="getOptionKey(option)"
            v-model="selectedOption"
            :disabled="showResult" 
            class="option-input"
          />
          <span class="option-label">{{ option }}</span>
        </label>
      </div>

      <div class="controls">
        <div v-if="!showResult">
          <button @click="submitAnswer" class="submit-btn" :disabled="!selectedOption">提交答案</button>
        </div>

        <div v-if="showResult">
          <!-- 答题结果 -->
          <div class="result-message" :class="isCorrect ? 'result-correct' : 'result-incorrect'">
            {{ isCorrect ? `回答正确！正确答案：${currentQuestion.answer}` : `回答错误！正确答案：${currentQuestion.answer}` }}
          </div>
          <!-- 解析与讨论 -->
          <div class="analysis">
            <div class="analysis-title">考点还原</div>
            <div class="analysis-content" v-html="currentQuestion.point"></div>
            <div class="discuss" v-if="currentQuestion.discuss">
              <strong>题目讨论：</strong>{{ currentQuestion.discuss }}
            </div>
          </div>
          <!-- 下一题按钮 -->
          <button @click="nextQuestion" class="next-btn" :disabled="currentQuestionIndex >= filterQuestions.length - 1">
            {{ currentQuestionIndex >= filterQuestions.length - 1 ? '已是最后一题' : '下一题' }}
          </button>
        </div>
      </div>
    </div>

    <div v-else-if="!showCollectModal" class="empty-state">
      <p>当前分类暂无题目或已完成所有题目！</p>
      <button @click="resetProgress" class="reset-btn">重新开始</button>
    </div>

    <!-- 收藏列表弹窗 -->
    <div class="modal" v-if="showCollectModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>我的收藏题目 ({{ collectedQuestions.length }})</h2>
          <button @click="closeCollectModal" class="close-btn">关闭</button>
        </div>
        
        <div v-if="collectedQuestions.length > 0">
          <div 
            v-for="question in collectedQuestions" 
            :key="question.name"
            class="collect-item"
            @click="goToCollectedQuestion(question)"
          >
            <strong>{{ question.mode }}：</strong>{{ question.test }}
            <div class="collect-item-meta">
              {{ question.cls }} - {{ question.unit }} | 题号：{{ question.numb }}
            </div>
          </div>
        </div>
        <div v-else class="empty-state">
          暂无收藏的题目
        </div>
        
        <button @click="closeCollectModal" class="back-btn">返回刷题</button>
      </div>
    </div>
  </div>

  <script>
    const { createApp, ref, computed, watch } = Vue;

    createApp({
      setup() {
        // ========== 题目数据：完全适配指定JSON格式 ==========
        const questions = ref([
          {
            "name": "2025-10-25-13-22-25-122",
            "cls": "医学心理学",
            "numb": "4",
            "all_numb": "19",
            "unit": "一、医学心理学总论",
            "mode": "A1型题",
            "test": "医学心理学的研究任务不包括",
            "option": [
              "A.医学管理中存在的心理问题解决办法",
              "B.疾病发生、发展过程中心理因素的作用规律",
              "C.心理因素对身体生理、生物化学功能的影响",
              "D.个性心理特征或行为模式在疾病的发生和康复中的意义",
              "E.研究运用医学心理学的原理达到防病治病、养生保健的目的"
            ],
            "answer": "A",
            "point": "（P2）“医学心理学的研究范围主要包括：（1）研究心理或行为的生物学和社会学基础及其在健康和疾病中的意义（D对）;（2）研究心身相互作用关系及其机制（C对）;（3）研究心理社会因素在疾病过程中的作用规律（B对）;（4）研究各种疾病过程中的心理和行为特征及变化规律;（5）研究医疗过程中医患关系的特征及增进医患关系的途径和方法;（6）研究如何将心理学原理及技术应用于人类的健康促进及疾病防治（E对）”。",
            "discuss": "旧版书中，医学心理学的具体任务包括：心理社会因素在疾病发生、发展和变化过程中的作用规律（B对）：心理评估手段在疾病的诊断、治疗、护理与预防中的作用：运用心理治疗的方法达到治病、防病和养生保健的目的（E对）：患者心理活动的特点及心理护理方法的运用（D对）。心理因素对身体生理、生物化学功能的影响（C对），因此，A错，为本题正确答案。该题目是教材改版前题目，参考即可，不必深究。请同学们以考点还原中的课本原文为主。"
          },
          {
            "name": "2025-10-25-13-25-48-567",
            "cls": "医学心理学",
            "numb": "5",
            "all_numb": "19",
            "unit": "一、医学心理学总论",
            "mode": "A1型题",
            "test": "医学心理学的研究对象是",
            "option": [
              "A.心理活动的规律",
              "B.行为活动的规律",
              "C.疾病的发生发展规律",
              "D.影响健康的心理因素和行为",
              "E.疾病的预防和治疗规律"
            ],
            "answer": "D",
            "point": "（P1）医学心理学是研究**心理因素、行为因素**与健康和疾病之间相互关系的科学，其研究对象是**影响健康的心理因素和行为**（D对），以及心理因素与生理、病理因素的相互作用。",
            "discuss": "心理活动的规律（A错）、行为活动的规律（B错）是普通心理学的研究对象；疾病的发生发展规律（C错）、疾病的预防和治疗规律（E错）是临床医学的研究范畴。医学心理学是交叉学科，核心是心身相互作用。"
          },
          {
            "name": "2025-10-26-09-10-20-333",
            "cls": "生理学",
            "numb": "2",
            "all_numb": "25",
            "unit": "一、细胞的基本功能",
            "mode": "A1型题",
            "test": "细胞膜的物质转运中，属于主动转运的是",
            "option": [
              "A.氧气的跨膜扩散",
              "B.葡萄糖进入红细胞",
              "C.钠离子的跨膜转运",
              "D.水的跨膜渗透",
              "E.二氧化碳的跨膜扩散"
            ],
            "answer": "C",
            "point": "（P15）主动转运是指细胞通过本身的耗能过程，将物质由膜的低浓度一侧向高浓度一侧转运的过程，包括原发性主动转运和继发性主动转运。钠离子的跨膜转运（C对）属于原发性主动转运，由钠钾泵介导，消耗ATP。",
            "discuss": "氧气（A错）、二氧化碳（E错）的跨膜扩散属于单纯扩散；葡萄糖进入红细胞（B错）属于易化扩散；水的跨膜渗透（D错）属于单纯扩散，均为被动转运，不消耗能量。"
          }
        ]);

        // ========== 本地存储配置 ==========
        const STORAGE_KEY = {
          progress: 'medical_question_progress', // 做题进度（分类+当前题索引）
          collected: 'medical_collected_questions', // 收藏题目
          finished: 'medical_finished_questions', // 完成答题的题目name
          collapse: 'medical_category_collapse' // 分类折叠状态（新增）
        };

        // ========== 响应式数据（新增：折叠状态管理） ==========
        const activeCategory = ref('all'); // 当前选中科目：all=全部，其他=科目名
        const activeUnit = ref('all');     // 当前选中单元：all=该科目全部，其他=单元名
        const currentQuestionIndex = ref(0); // 当前题在筛选列表中的索引
        const selectedOption = ref(null); // 选中的选项（A/B/C/D/E）
        const showResult = ref(false);    // 是否显示答题结果
        const isCorrect = ref(null);      // 答案是否正确
        const collectedQuestions = ref([]); // 收藏题目列表
        const finishedQuestionNames = ref([]); // 已完成的题目name数组
        const showCollectModal = ref(false); // 收藏弹窗显示状态
        const collapseStatus = ref({});   // 分类折叠状态：{科目名: 布尔值}，true=展开，false=折叠

        // ========== 自动生成二级分类：科目+单元 ==========
        const subjectCategories = computed(() => {
          const categories = {};
          questions.value.forEach(q => {
            if (!categories[q.cls]) {
              categories[q.cls] = new Set();
            }
            categories[q.cls].add(q.unit);
          });
          // 转换为数组，并初始化折叠状态（首次加载默认展开）
          Object.keys(categories).forEach(key => {
            categories[key] = Array.from(categories[key]);
            if (collapseStatus.value[key] === undefined) {
              collapseStatus.value[key] = true;
            }
          });
          return categories;
        });

        // ========== 筛选当前分类的题目 ==========
        const filterQuestions = computed(() => {
          return questions.value.filter(q => {
            // 科目筛选
            if (activeCategory.value !== 'all' && q.cls !== activeCategory.value) return false;
            // 单元筛选
            if (activeUnit.value !== 'all' && q.unit !== activeUnit.value) return false;
            return true;
          });
        });

        // ========== 当前答题的题目 ==========
        const currentQuestion = computed(() => {
          if (filterQuestions.value.length > 0 && currentQuestionIndex.value < filterQuestions.value.length) {
            return filterQuestions.value[currentQuestionIndex.value];
          }
          return null;
        });

        // ========== 当前分类名称（用于进度显示） ==========
        const activeCategoryName = computed(() => {
          if (activeCategory.value === 'all') return '全部题目';
          if (activeUnit.value === 'all') return activeCategory.value;
          return `${activeCategory.value}-${activeUnit.value}`;
        });

        // ========== 当前题目是否已收藏 ==========
        const isCollected = computed(() => {
          if (!currentQuestion.value) return false;
          return collectedQuestions.value.some(item => item.name === currentQuestion.value.name);
        });

        // ========== 本地存储方法（新增：折叠状态的保存/加载） ==========
        // 加载本地存储数据
        const loadStorage = () => {
          // 加载进度
          const savedProgress = localStorage.getItem(STORAGE_KEY.progress);
          if (savedProgress) {
            const { category, unit, index } = JSON.parse(savedProgress);
            activeCategory.value = category;
            activeUnit.value = unit;
            currentQuestionIndex.value = index;
          }
          // 加载收藏
          const savedCollected = localStorage.getItem(STORAGE_KEY.collected);
          if (savedCollected) collectedQuestions.value = JSON.parse(savedCollected);
          // 加载完成记录
          const savedFinished = localStorage.getItem(STORAGE_KEY.finished);
          if (savedFinished) finishedQuestionNames.value = JSON.parse(savedFinished);
          // 加载折叠状态（新增）
          const savedCollapse = localStorage.getItem(STORAGE_KEY.collapse);
          if (savedCollapse) collapseStatus.value = JSON.parse(savedCollapse);
        };

        // 保存做题进度
        const saveProgress = () => {
          localStorage.setItem(STORAGE_KEY.progress, JSON.stringify({
            category: activeCategory.value,
            unit: activeUnit.value,
            index: currentQuestionIndex.value
          }));
        };

        // 保存收藏题目
        const saveCollected = () => {
          localStorage.setItem(STORAGE_KEY.collected, JSON.stringify(collectedQuestions.value));
        };

        // 保存完成的题目
        const saveFinished = () => {
          localStorage.setItem(STORAGE_KEY.finished, JSON.stringify(finishedQuestionNames.value));
        };

        // 保存折叠状态（新增）
        const saveCollapseStatus = () => {
          localStorage.setItem(STORAGE_KEY.collapse, JSON.stringify(collapseStatus.value));
        };

        // ========== 核心业务方法（新增：折叠/展开切换） ==========
        // 提取选项的前缀（A/B/C/D/E）
        const getOptionKey = (option) => {
          return option.charAt(0);
        };

        // 判断题目是否已完成
        const isQuestionFinished = (name) => {
          return finishedQuestionNames.value.includes(name);
        };

        // 判断题目是否已收藏
        const isQuestionCollected = (name) => {
          return collectedQuestions.value.some(item => item.name === name);
        };

        // 折叠/展开分类（新增核心方法）
        const toggleCollapse = (key) => {
          // 切换折叠状态
          collapseStatus.value[key] = !collapseStatus.value[key];
          // 若当前选中的是该科目下的单元，折叠时不切换分类；展开时保持选中
          if (collapseStatus.value[key] === false && activeCategory.value === key && activeUnit.value !== 'all') {
            switchCategory(key, 'all');
          }
          // 保存折叠状态到本地
          saveCollapseStatus();
        };

        // 切换分类（科目+单元）
        const switchCategory = (category, unit = 'all') => {
          activeCategory.value = category;
          activeUnit.value = unit;
          currentQuestionIndex.value = 0; // 切换分类回到第一题
          saveProgress();
          resetAnswerState();
          // 切换到某科目/单元时，自动展开该科目（新增）
          if (category !== 'all') {
            collapseStatus.value[category] = true;
            saveCollapseStatus();
          }
        };

        // 从题目列表跳转到指定题目
        const goToQuestion = (index) => {
          currentQuestionIndex.value = index;
          saveProgress();
          resetAnswerState();
        };

        // 重置答题状态（选中项、结果、是否正确）
        const resetAnswerState = () => {
          selectedOption.value = null;
          showResult.value = false;
          isCorrect.value = null;
        };

        // 提交答案
        const submitAnswer = () => {
          if (!selectedOption.value || !currentQuestion.value) return;
          // 校验答案：直接匹配answer字段
          isCorrect.value = selectedOption.value === currentQuestion.value.answer;
          showResult.value = true;
          // 记录完成的题目（去重）
          if (!finishedQuestionNames.value.includes(currentQuestion.value.name)) {
            finishedQuestionNames.value.push(currentQuestion.value.name);
            saveFinished();
          }
        };

        // 下一题
        const nextQuestion = () => {
          if (currentQuestionIndex.value >= filterQuestions.value.length - 1) return;
          currentQuestionIndex.value++;
          saveProgress();
          resetAnswerState();
        };

        // 收藏/取消收藏题目
        const toggleCollect = () => {
          if (!currentQuestion.value) return;
          const index = collectedQuestions.value.findIndex(item => item.name === currentQuestion.value.name);
          if (index > -1) {
            collectedQuestions.value.splice(index, 1); // 取消收藏
          } else {
            collectedQuestions.value.push({ ...currentQuestion.value }); // 添加收藏
          }
          saveCollected();
        };

        // 重置所有做题进度
        const resetProgress = () => {
          activeCategory.value = 'all';
          activeUnit.value = 'all';
          currentQuestionIndex.value = 0;
          finishedQuestionNames.value = [];
          resetAnswerState();
          saveProgress();
          saveFinished();
        };

        // ========== 收藏列表相关方法 ==========
        const showCollectList = () => {
          showCollectModal.value = true;
        };
        const closeCollectModal = () => {
          showCollectModal.value = false;
        };
        // 从收藏列表跳转到对应题目
        const goToCollectedQuestion = (question) => {
          activeCategory.value = question.cls;
          activeUnit.value = question.unit;
          // 找到该题目在对应分类中的索引
          const index = filterQuestions.value.findIndex(q => q.name === question.name);
          if (index > -1) currentQuestionIndex.value = index;
          saveProgress();
          resetAnswerState();
          closeCollectModal();
        };

        // ========== 监听与初始化 ==========
        // 监听进度变化，自动保存
        watch([activeCategory, activeUnit, currentQuestionIndex], () => {
          saveProgress();
        });
        // 监听折叠状态变化，自动保存（新增）
        watch(collapseStatus, () => {
          saveCollapseStatus();
        }, { deep: true });
        // 初始化加载本地存储数据
        loadStorage();

        return {
          questions,
          subjectCategories,
          filterQuestions,
          currentQuestion,
          activeCategory,
          activeUnit,
          activeCategoryName,
          currentQuestionIndex,
          selectedOption,
          showResult,
          isCorrect,
          collectedQuestions,
          showCollectModal,
          isCollected,
          collapseStatus,
          // 方法
          getOptionKey,
          isQuestionFinished,
          isQuestionCollected,
          toggleCollapse,
          switchCategory,
          goToQuestion,
          submitAnswer,
          nextQuestion,
          toggleCollect,
          resetProgress,
          showCollectList,
          closeCollectModal,
          goToCollectedQuestion
        };
      },
    }).mount("#app");
  </script>
</body>
</html>