<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>åŒ»å­¦åœ¨çº¿åˆ·é¢˜è½¯ä»¶ - GitHubé¢˜åº“ç‰ˆ</title>
  <!-- å¼•å…¥ Vue 3 çš„ CDN é“¾æ¥ -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f0f2f5;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      box-sizing: border-box;
    }
    #app {
      max-width: 1000px;
      width: 100%;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 30px;
      box-sizing: border-box;
      margin-top: 20px;
    }
    /* GitHubé…ç½®é¢æ¿æ ·å¼ */
    .github-config {
      background-color: #f8f9fa;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 25px;
      border: 1px solid #eee;
    }
    .config-title {
      font-size: 1.1em;
      font-weight: 600;
      margin-bottom: 15px;
      color: #333;
    }
    .config-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .form-label {
      font-size: 0.95em;
      color: #444;
      font-weight: 500;
    }
    .form-input {
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 1em;
      width: 100%;
      box-sizing: border-box;
    }
    .form-input:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.1);
    }
    .config-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .load-btn {
      background-color: #007bff;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1em;
    }
    .load-btn:hover {
      background-color: #0056b3;
    }
    .load-btn:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    .reset-config-btn {
      background-color: #6c757d;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1em;
    }
    .reset-config-btn:hover {
      background-color: #5a6268;
    }
    .loading {
      color: #007bff;
      font-size: 0.95em;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .error-message {
      color: #dc3545;
      font-size: 0.95em;
      padding: 10px;
      background-color: #ffebee;
      border-radius: 6px;
      margin-top: 10px;
    }
    .success-message {
      color: #28a745;
      font-size: 0.95em;
      padding: 10px;
      background-color: #e8f5e9;
      border-radius: 6px;
      margin-top: 10px;
    }
    /* é¡¶éƒ¨å¤´éƒ¨ä¸æ“ä½œåŒº */
    .app-header {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 25px;
    }
    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    .header-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    /* åˆ†ç±»ä¸é¢˜ç›®åˆ—è¡¨å®¹å™¨ - å·¦å³å¸ƒå±€ */
    .question-nav {
      display: flex;
      gap: 20px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }
    /* åˆ†ç±»ç­›é€‰æ  - æŠ˜å æ ·å¼ */
    .category-list {
      min-width: 200px;
      width: 22%;
      border: 1px solid #eee;
      border-radius: 6px;
      padding: 15px;
      box-sizing: border-box;
    }
    .category-title {
      font-size: 1.1em;
      font-weight: 600;
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 1px solid #eee;
    }
    .category-item {
      padding: 10px 8px;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 8px;
      transition: all 0.2s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .category-item:hover {
      background-color: #f9f9f9;
    }
    .category-item.active {
      background-color: #e3f2fd;
      color: #007bff;
      font-weight: 500;
    }
    /* æŠ˜å /å±•å¼€å›¾æ ‡æ ·å¼ */
    .collapse-icon {
      font-size: 0.8em;
      transition: transform 0.2s ease;
    }
    .collapse-icon.rotate {
      transform: rotate(90deg);
    }
    /* å•å…ƒäºŒçº§åˆ†ç±»æ ·å¼ */
    .sub-category-wrap {
      margin-left: 8px;
      margin-bottom: 8px;
    }
    .sub-category {
      padding: 10px 8px;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 5px;
      font-size: 0.95em;
      transition: all 0.2s ease;
    }
    .sub-category:hover {
      background-color: #f9f9f9;
    }
    .sub-category.active {
      background-color: #e3f2fd;
      color: #007bff;
      font-weight: 500;
    }
    /* é¢˜ç›®åˆ—è¡¨æ  */
    .question-list {
      flex: 1;
      border: 1px solid #eee;
      border-radius: 6px;
      padding: 15px;
      box-sizing: border-box;
      max-height: 200px;
      overflow-y: auto;
    }
    .question-list-title {
      font-size: 1.1em;
      font-weight: 600;
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .question-list-count {
      font-size: 0.9em;
      font-weight: 400;
      color: #666;
    }
    .question-item {
      padding: 10px 8px;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.2s ease;
    }
    .question-item:hover {
      background-color: #f9f9f9;
    }
    .question-item.active {
      background-color: #e3f2fd;
      border-left: 3px solid #007bff;
    }
    .question-item.collected {
      color: #dc3545;
    }
    .question-item-finished {
      color: #4caf50;
      font-size: 0.9em;
    }
    .question-item-info {
      font-size: 0.85em;
      color: #999;
    }
    /* ç­”é¢˜åŒºæ ·å¼ */
    .question-container {
      margin-bottom: 25px;
    }
    .question-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      font-size: 0.9em;
      color: #666;
      margin-bottom: 10px;
    }
    .question-title {
      font-size: 1.4em;
      color: #333;
      line-height: 1.6;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
      gap: 10px;
    }
    .options-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 15px;
    }
    .option-item {
      display: flex;
      align-items: flex-start;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      line-height: 1.5;
    }
    .option-item:hover {
      background-color: #f9f9f9;
      border-color: #007bff;
    }
    .option-item.selected {
      background-color: #e3f2fd;
      border-color: #007bff;
    }
    .option-item.correct {
      background-color: #e8f5e9;
      border-color: #4caf50;
    }
    .option-item.incorrect {
      background-color: #ffebee;
      border-color: #f44336;
    }
    .option-input {
      margin-right: 12px;
      margin-top: 4px;
      cursor: pointer;
    }
    .option-label {
      flex-grow: 1;
      cursor: pointer;
    }
    .controls {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin-top: 20px;
    }
    button {
      padding: 10px 20px;
      font-size: 1em;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .submit-btn {
      background-color: #007bff;
      color: white;
    }
    .submit-btn:hover:not(:disabled) {
      background-color: #0056b3;
    }
    .submit-btn:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    .next-btn {
      background-color: #28a745;
      color: white;
    }
    .next-btn:hover {
      background-color: #218838;
    }
    .next-btn:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    .collect-btn {
      background-color: #ffc107;
      color: #333;
    }
    .collect-btn:hover {
      background-color: #e0a800;
    }
    .collect-btn.collected {
      background-color: #dc3545;
      color: white;
    }
    .reset-btn {
      background-color: #6c757d;
      color: white;
    }
    .reset-btn:hover {
      background-color: #5a6268;
    }
    .collect-list-btn {
      background-color: #17a2b8;
      color: white;
    }
    .collect-list-btn:hover {
      background-color: #138496;
    }
    .result-message {
      margin-top: 15px;
      padding: 12px;
      border-radius: 4px;
      font-weight: bold;
      font-size: 1.05em;
    }
    .result-correct {
      color: #4caf50;
      background-color: #f1f8e9;
      border: 1px solid #c8e6c9;
    }
    .result-incorrect {
      color: #f44336;
      background-color: #ffebee;
      border: 1px solid #ffcdd2;
    }
    .analysis {
      margin-top: 15px;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 6px;
      line-height: 1.6;
    }
    .analysis-title {
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
    }
    .analysis-content {
      color: #444;
    }
    .discuss {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px dashed #ddd;
      color: #666;
      font-size: 0.95em;
    }
    .progress {
      text-align: right;
      color: #666;
      margin-bottom: 10px;
      font-size: 0.95em;
    }
    /* å¼¹çª—æ ·å¼ */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background-color: white;
      border-radius: 10px;
      padding: 30px;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
    }
    .close-btn {
      background-color: #dc3545;
      color: white;
      padding: 8px 16px;
      font-size: 0.9em;
    }
    .collect-item {
      padding: 15px;
      border: 1px solid #eee;
      border-radius: 6px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      line-height: 1.5;
    }
    .collect-item:hover {
      background-color: #f8f9fa;
      border-color: #007bff;
    }
    .collect-item-meta {
      font-size: 0.85em;
      color: #999;
      margin-top: 5px;
    }
    .back-btn {
      background-color: #6c757d;
      color: white;
      margin-top: 20px;
    }
    /* ç©ºçŠ¶æ€æ ·å¼ */
    .empty-state {
      text-align: center;
      color: #666;
      padding: 20px 0;
      font-size: 0.95em;
    }
    /* é€‚é…ç§»åŠ¨ç«¯ */
    @media (max-width: 768px) {
      .question-nav {
        flex-direction: column;
      }
      .category-list {
        width: 100%;
      }
      .question-title {
        font-size: 1.2em;
      }
      button {
        padding: 8px 16px;
        font-size: 0.95em;
      }
      .app-header {
        gap: 10px;
      }
      .question-meta {
        gap: 10px;
      }
      .config-form {
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- GitHubä»“åº“é…ç½®é¢æ¿ï¼ˆæ–°å¢æ ¸å¿ƒåŠŸèƒ½ï¼‰ -->
    <div class="github-config">
      <div class="config-title">GitHubé¢˜åº“é…ç½®</div>
      <div class="config-form">
        <div class="form-group">
          <label class="form-label">GitHubä»“åº“åœ°å€ï¼ˆæ ¼å¼ï¼šowner/repoï¼Œå¦‚ï¼šusername/medical-questionsï¼‰</label>
          <input 
            v-model="githubRepo" 
            type="text" 
            class="form-input" 
            placeholder="è¯·è¾“å…¥ä»“åº“åœ°å€ï¼Œä¾‹å¦‚ï¼šoctocat/medical-questions"
          />
        </div>
        <div class="form-group">
          <label class="form-label">GitHub Personal Access Tokenï¼ˆç”¨äºè®¿é—®ç§æœ‰ä»“åº“ï¼Œå…¬ä»“å¯ç•™ç©ºï¼‰</label>
          <input 
            v-model="githubToken" 
            type="password" 
            class="form-input" 
            placeholder="è¯·è¾“å…¥ä½ çš„GitHub Tokenï¼ˆrepoæƒé™ï¼‰"
          />
        </div>
        <div class="form-group">
          <label class="form-label">é¢˜åº“æ–‡ä»¶è·¯å¾„ï¼ˆå¯é€‰ï¼Œé»˜è®¤æ ¹ç›®å½•ï¼Œå¦‚ï¼šquestions/medical/ï¼‰</label>
          <input 
            v-model="githubPath" 
            type="text" 
            class="form-input" 
            placeholder="ä»“åº“ä¸­é¢˜ç›®æ–‡ä»¶æ‰€åœ¨è·¯å¾„ï¼Œä¾‹å¦‚ï¼šquestions/medical/"
          />
        </div>
        <div class="config-actions">
          <button 
            @click="loadQuestionsFromGitHub" 
            class="load-btn"
            :disabled="loading || !githubRepo"
          >
            {{ loading ? 'åŠ è½½ä¸­...' : 'åŠ è½½é¢˜åº“' }}
          </button>
          <button @click="resetConfig" class="reset-config-btn">é‡ç½®é…ç½®</button>
        </div>
        <div v-if="loading" class="loading">
          <span>ğŸ”„ æ­£åœ¨ä»GitHubåŠ è½½é¢˜ç›®ï¼Œè¯·ç¨å€™...</span>
        </div>
        <div v-if="errorMsg" class="error-message">
          âŒ {{ errorMsg }}
        </div>
        <div v-if="successMsg" class="success-message">
          âœ… {{ successMsg }}
        </div>
      </div>
    </div>

    <!-- åˆ·é¢˜æ ¸å¿ƒåŒºåŸŸï¼ˆé¢˜åº“åŠ è½½æˆåŠŸåæ˜¾ç¤ºï¼‰ -->
    <div v-if="questionsLoaded">
      <div class="app-header">
        <div class="header-top">
          <h1>åŒ»å­¦åœ¨çº¿åˆ·é¢˜ (GitHubé¢˜åº“)</h1>
          <div class="header-actions">
            <button @click="showCollectList" class="collect-list-btn">æˆ‘çš„æ”¶è—</button>
            <button @click="resetProgress" class="reset-btn">é‡ç½®è¿›åº¦</button>
          </div>
        </div>
        <div class="progress">
          å½“å‰åˆ†ç±»ï¼š{{ activeCategoryName }} | ç¬¬ {{ currentQuestionIndex + 1 }} é¢˜ / å…± {{ filterQuestions.length }} é¢˜
        </div>
      </div>

      <!-- é¢˜ç›®åˆ†ç±» + é¢˜ç›®åˆ—è¡¨ å¯¼èˆªåŒº -->
      <div class="question-nav">
        <!-- åˆ†ç±»ç­›é€‰ï¼šç§‘ç›®+å•å…ƒäºŒçº§åˆ†ç±»ï¼ˆå¯æŠ˜å ï¼‰ -->
        <div class="category-list">
          <div class="category-title">é¢˜ç›®åˆ†ç±»</div>
          <!-- å…¨éƒ¨é¢˜ç›® -->
          <div 
            class="category-item"
            :class="{ active: activeCategory === 'all' }"
            @click="switchCategory('all')"
          >
            <span>å…¨éƒ¨é¢˜ç›® ({{ questions.length }})</span>
          </div>
          <!-- ç§‘ç›®ä¸€çº§åˆ†ç±»ï¼ˆå¯æŠ˜å ï¼‰ -->
          <div v-for="(subject, key) in subjectCategories" :key="key">
            <div 
              class="category-item"
              :class="{ active: activeCategory === key && activeUnit === 'all' }"
              @click="toggleCollapse(key)"
            >
              <span>{{ key }} ({{ subject.length }})</span>
              <!-- æŠ˜å /å±•å¼€å›¾æ ‡ -->
              <span class="collapse-icon" :class="{ rotate: collapseStatus[key] }">â–¶</span>
            </div>
            <!-- å•å…ƒäºŒçº§åˆ†ç±»ï¼ˆæ ¹æ®æŠ˜å çŠ¶æ€æ˜¾ç¤º/éšè—ï¼‰ -->
            <div v-show="collapseStatus[key]" class="sub-category-wrap">
              <div 
                v-for="unit in subject" 
                :key="unit"
                class="sub-category"
                :class="{ active: activeCategory === key && activeUnit === unit }"
                @click="switchCategory(key, unit)"
              >
                {{ unit }}
              </div>
            </div>
          </div>
        </div>

        <!-- é¢˜ç›®åˆ—è¡¨ -->
        <div class="question-list">
          <div class="question-list-title">
            é¢˜ç›®åˆ—è¡¨
            <span class="question-list-count">å…± {{ filterQuestions.length }} é¢˜</span>
          </div>
          <div v-if="filterQuestions.length === 0" class="empty-state">
            è¯¥åˆ†ç±»æš‚æ— é¢˜ç›®
          </div>
          <div 
            v-else
            v-for="(q, index) in filterQuestions" 
            :key="q.name"
            class="question-item"
            :class="{
              active: currentQuestion?.name === q.name,
              collected: isQuestionCollected(q.name)
            }"
            @click="goToQuestion(index)"
          >
            <div>
              <span>{{ q.mode }} ç¬¬{{ q.numb }}é¢˜</span>
              <div class="question-item-info">{{ q.test.substring(0, 25) }}{{ q.test.length > 25 ? '...' : '' }}</div>
            </div>
            <span v-if="isQuestionFinished(q.name)" class="question-item-finished">å·²å®Œæˆ</span>
          </div>
        </div>
      </div>

      <!-- æ ¸å¿ƒç­”é¢˜åŒº -->
      <div class="question-container" v-if="currentQuestion && !showCollectModal">
        <!-- é¢˜ç›®å…ƒä¿¡æ¯ï¼šç§‘ç›®ã€å•å…ƒã€é¢˜å‹ -->
        <div class="question-meta">
          <span>ç§‘ç›®ï¼š{{ currentQuestion.cls }}</span>
          <span>å•å…ƒï¼š{{ currentQuestion.unit }}</span>
          <span>é¢˜å‹ï¼š{{ currentQuestion.mode }}</span>
          <span>é¢˜å·ï¼š{{ currentQuestion.numb }}/{{ currentQuestion.all_numb }}</span>
        </div>
        <!-- é¢˜å¹² -->
        <div class="question-title">
          <span>{{ currentQuestion.test }}</span>
          <button 
            @click="toggleCollect" 
            class="collect-btn"
            :class="{ collected: isCollected }"
          >
            {{ isCollected ? 'å–æ¶ˆæ”¶è—' : 'æ”¶è—é¢˜ç›®' }}
          </button>
        </div>
        <!-- é€‰é¡¹ -->
        <div class="options-container">
          <label 
            v-for="(option, index) in currentQuestion.option" 
            :key="index"
            class="option-item"
            :class="{
              'selected': selectedOption === getOptionKey(option),
              'correct': showResult && getOptionKey(option) === currentQuestion.answer,
              'incorrect': showResult && selectedOption === getOptionKey(option) && selectedOption !== currentQuestion.answer
            }"
          >
            <input
              type="radio"
              :value="getOptionKey(option)"
              v-model="selectedOption"
              :disabled="showResult" 
              class="option-input"
            />
            <span class="option-label">{{ option }}</span>
          </label>
        </div>

        <div class="controls">
          <div v-if="!showResult">
            <button @click="submitAnswer" class="submit-btn" :disabled="!selectedOption">æäº¤ç­”æ¡ˆ</button>
          </div>

          <div v-if="showResult">
            <!-- ç­”é¢˜ç»“æœ -->
            <div class="result-message" :class="isCorrect ? 'result-correct' : 'result-incorrect'">
              {{ isCorrect ? `å›ç­”æ­£ç¡®ï¼æ­£ç¡®ç­”æ¡ˆï¼š${currentQuestion.answer}` : `å›ç­”é”™è¯¯ï¼æ­£ç¡®ç­”æ¡ˆï¼š${currentQuestion.answer}` }}
            </div>
            <!-- è§£æä¸è®¨è®º -->
            <div class="analysis">
              <div class="analysis-title">è€ƒç‚¹è¿˜åŸ</div>
              <div class="analysis-content" v-html="currentQuestion.point"></div>
              <div class="discuss" v-if="currentQuestion.discuss">
                <strong>é¢˜ç›®è®¨è®ºï¼š</strong>{{ currentQuestion.discuss }}
              </div>
            </div>
            <!-- ä¸‹ä¸€é¢˜æŒ‰é’® -->
            <button @click="nextQuestion" class="next-btn" :disabled="currentQuestionIndex >= filterQuestions.length - 1">
              {{ currentQuestionIndex >= filterQuestions.length - 1 ? 'å·²æ˜¯æœ€åä¸€é¢˜' : 'ä¸‹ä¸€é¢˜' }}
            </button>
          </div>
        </div>
      </div>

      <div v-else-if="!showCollectModal" class="empty-state">
        <p>å½“å‰åˆ†ç±»æš‚æ— é¢˜ç›®æˆ–å·²å®Œæˆæ‰€æœ‰é¢˜ç›®ï¼</p>
        <button @click="resetProgress" class="reset-btn">é‡æ–°å¼€å§‹</button>
      </div>

      <!-- æ”¶è—åˆ—è¡¨å¼¹çª— -->
      <div class="modal" v-if="showCollectModal">
        <div class="modal-content">
          <div class="modal-header">
            <h2>æˆ‘çš„æ”¶è—é¢˜ç›® ({{ collectedQuestions.length }})</h2>
            <button @click="closeCollectModal" class="close-btn">å…³é—­</button>
          </div>
          
          <div v-if="collectedQuestions.length > 0">
            <div 
              v-for="question in collectedQuestions" 
              :key="question.name"
              class="collect-item"
              @click="goToCollectedQuestion(question)"
            >
              <strong>{{ question.mode }}ï¼š</strong>{{ question.test }}
              <div class="collect-item-meta">
                {{ question.cls }} - {{ question.unit }} | é¢˜å·ï¼š{{ question.numb }}
              </div>
            </div>
          </div>
          <div v-else class="empty-state">
            æš‚æ— æ”¶è—çš„é¢˜ç›®
          </div>
          
          <button @click="closeCollectModal" class="back-btn">è¿”å›åˆ·é¢˜</button>
        </div>
      </div>
    </div>

    <!-- æœªåŠ è½½é¢˜åº“æ—¶çš„æç¤º -->
    <div v-else class="empty-state">
      <p>è¯·å…ˆåœ¨ä¸Šæ–¹é…ç½®GitHubä»“åº“ä¿¡æ¯å¹¶ç‚¹å‡»"åŠ è½½é¢˜åº“"æŒ‰é’®ï¼ŒåŠ è½½é¢˜ç›®åå³å¯å¼€å§‹åˆ·é¢˜ï¼</p>
      <p style="margin-top: 10px; font-size: 0.9em; color: #999;">
        æç¤ºï¼š1. ä»“åº“ä¸­éœ€å­˜æ”¾ç¬¦åˆæ ¼å¼çš„JSONé¢˜ç›®æ–‡ä»¶ï¼›2. Tokenéœ€æœ‰repoæƒé™ï¼ˆç§æœ‰ä»“åº“å¿…å¡«ï¼‰ï¼›3. æ–‡ä»¶åæ— ç‰¹æ®Šè¦æ±‚ï¼Œåç¼€ä¸º.jsonå³å¯
      </p>
    </div>
  </div>

  <script>
    const { createApp, ref, computed, watch } = Vue;

    createApp({
      setup() {
        // ========== GitHubé…ç½®ç›¸å…³å“åº”å¼æ•°æ®ï¼ˆæ–°å¢æ ¸å¿ƒï¼‰ ==========
        const githubRepo = ref(''); // GitHubä»“åº“åœ°å€ï¼šowner/repo
        const githubToken = ref(''); // GitHub Token
        const githubPath = ref(''); // ä»“åº“ä¸­é¢˜ç›®æ–‡ä»¶è·¯å¾„
        const loading = ref(false); // åŠ è½½çŠ¶æ€
        const errorMsg = ref(''); // é”™è¯¯ä¿¡æ¯
        const successMsg = ref(''); // æˆåŠŸä¿¡æ¯
        const questionsLoaded = ref(false); // é¢˜åº“æ˜¯å¦åŠ è½½å®Œæˆ

        // ========== é¢˜ç›®æ•°æ®ï¼ˆåˆå§‹ä¸ºç©ºï¼Œä»GitHubåŠ è½½ï¼‰ ==========
        const questions = ref([]);

        // ========== æœ¬åœ°å­˜å‚¨é…ç½®ï¼ˆæ–°å¢GitHubé…ç½®å­˜å‚¨ï¼‰ ==========
        const STORAGE_KEY = {
          progress: 'medical_question_progress', // åšé¢˜è¿›åº¦ï¼ˆåˆ†ç±»+å½“å‰é¢˜ç´¢å¼•ï¼‰
          collected: 'medical_collected_questions', // æ”¶è—é¢˜ç›®
          finished: 'medical_finished_questions', // å®Œæˆç­”é¢˜çš„é¢˜ç›®name
          collapse: 'medical_category_collapse', // åˆ†ç±»æŠ˜å çŠ¶æ€
          githubConfig: 'medical_github_config' // GitHubé…ç½®ä¿¡æ¯
        };

        // ========== åˆ·é¢˜ç›¸å…³å“åº”å¼æ•°æ® ==========
        const activeCategory = ref('all'); // å½“å‰é€‰ä¸­ç§‘ç›®ï¼šall=å…¨éƒ¨ï¼Œå…¶ä»–=ç§‘ç›®å
        const activeUnit = ref('all');     // å½“å‰é€‰ä¸­å•å…ƒï¼šall=è¯¥ç§‘ç›®å…¨éƒ¨ï¼Œå…¶ä»–=å•å…ƒå
        const currentQuestionIndex = ref(0); // å½“å‰é¢˜åœ¨ç­›é€‰åˆ—è¡¨ä¸­çš„ç´¢å¼•
        const selectedOption = ref(null); // é€‰ä¸­çš„é€‰é¡¹ï¼ˆA/B/C/D/Eï¼‰
        const showResult = ref(false);    // æ˜¯å¦æ˜¾ç¤ºç­”é¢˜ç»“æœ
        const isCorrect = ref(null);      // ç­”æ¡ˆæ˜¯å¦æ­£ç¡®
        const collectedQuestions = ref([]); // æ”¶è—é¢˜ç›®åˆ—è¡¨
        const finishedQuestionNames = ref([]); // å·²å®Œæˆçš„é¢˜ç›®nameæ•°ç»„
        const showCollectModal = ref(false); // æ”¶è—å¼¹çª—æ˜¾ç¤ºçŠ¶æ€
        const collapseStatus = ref({});   // åˆ†ç±»æŠ˜å çŠ¶æ€ï¼š{ç§‘ç›®å: å¸ƒå°”å€¼}

        // ========== åŠ è½½æœ¬åœ°å­˜å‚¨ï¼ˆæ–°å¢GitHubé…ç½®åŠ è½½ï¼‰ ==========
        const loadStorage = () => {
          // åŠ è½½GitHubé…ç½®
          const savedConfig = localStorage.getItem(STORAGE_KEY.githubConfig);
          if (savedConfig) {
            const { repo, token, path } = JSON.parse(savedConfig);
            githubRepo.value = repo;
            githubToken.value = token;
            githubPath.value = path;
          }

          // åŠ è½½åˆ·é¢˜è¿›åº¦
          const savedProgress = localStorage.getItem(STORAGE_KEY.progress);
          if (savedProgress) {
            const { category, unit, index } = JSON.parse(savedProgress);
            activeCategory.value = category;
            activeUnit.value = unit;
            currentQuestionIndex.value = index;
          }

          // åŠ è½½æ”¶è—
          const savedCollected = localStorage.getItem(STORAGE_KEY.collected);
          if (savedCollected) collectedQuestions.value = JSON.parse(savedCollected);

          // åŠ è½½å®Œæˆè®°å½•
          const savedFinished = localStorage.getItem(STORAGE_KEY.finished);
          if (savedFinished) finishedQuestionNames.value = JSON.parse(savedFinished);

          // åŠ è½½æŠ˜å çŠ¶æ€
          const savedCollapse = localStorage.getItem(STORAGE_KEY.collapse);
          if (savedCollapse) collapseStatus.value = JSON.parse(savedCollapse);
        };

        // ========== ä¿å­˜GitHubé…ç½®ï¼ˆæ–°å¢ï¼‰ ==========
        const saveGitHubConfig = () => {
          localStorage.setItem(STORAGE_KEY.githubConfig, JSON.stringify({
            repo: githubRepo.value,
            token: githubToken.value,
            path: githubPath.value
          }));
        };

        // ========== ä»GitHubåŠ è½½é¢˜ç›®æ ¸å¿ƒæ–¹æ³•ï¼ˆæ–°å¢ï¼‰ ==========
        const loadQuestionsFromGitHub = async () => {
          // é‡ç½®çŠ¶æ€
          loading.value = true;
          errorMsg.value = '';
          successMsg.value = '';
          questions.value = [];
          questionsLoaded.value = false;

          try {
            // 1. éªŒè¯ä»“åº“åœ°å€æ ¼å¼
            if (!githubRepo.value || !githubRepo.value.includes('/')) {
              throw new Error('ä»“åº“åœ°å€æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥ï¼šowner/repoï¼ˆå¦‚ï¼šoctocat/medical-questionsï¼‰');
            }

            // 2. æ‹†åˆ†ä»“åº“ä¿¡æ¯
            const [owner, repo] = githubRepo.value.split('/');
            const path = githubPath.value.trim() || '';
            
            // 3. æ„å»ºAPIè¯·æ±‚å‚æ•°
            const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
            const headers = {};
            if (githubToken.value) {
              headers['Authorization'] = `token ${githubToken.value}`;
            }
            headers['Accept'] = 'application/vnd.github.v3+json';

            // 4. è¯·æ±‚ä»“åº“æ–‡ä»¶åˆ—è¡¨
            const response = await fetch(apiUrl, { headers });
            if (!response.ok) {
              const errorData = await response.json();
              throw new Error(`GitHub APIè¯·æ±‚å¤±è´¥ï¼š${errorData.message || `HTTP ${response.status}`}`);
            }

            const files = await response.json();
            
            // 5. ç­›é€‰JSONæ–‡ä»¶
            const jsonFiles = files.filter(file => 
              file.type === 'file' && file.name.endsWith('.json')
            );

            if (jsonFiles.length === 0) {
              throw new Error(`åœ¨ä»“åº“ ${githubRepo.value} çš„ ${path || 'æ ¹'} ç›®å½•ä¸‹æœªæ‰¾åˆ°JSONæ ¼å¼çš„é¢˜ç›®æ–‡ä»¶`);
            }

            // 6. æ‰¹é‡åŠ è½½JSONé¢˜ç›®æ–‡ä»¶
            const questionPromises = jsonFiles.map(async (file) => {
              const fileResponse = await fetch(file.download_url, { headers });
              if (!fileResponse.ok) {
                console.warn(`åŠ è½½æ–‡ä»¶ ${file.name} å¤±è´¥ï¼Œè·³è¿‡è¯¥æ–‡ä»¶`);
                return null;
              }
              try {
                const questionData = await fileResponse.json();
                // éªŒè¯é¢˜ç›®æ ¼å¼ï¼ˆæ ¸å¿ƒå­—æ®µæ£€æŸ¥ï¼‰
                const requiredFields = ['name', 'cls', 'numb', 'all_numb', 'unit', 'mode', 'test', 'option', 'answer', 'point'];
                const missingFields = requiredFields.filter(field => !questionData[field]);
                if (missingFields.length > 0) {
                  console.warn(`æ–‡ä»¶ ${file.name} ç¼ºå°‘å¿…å¡«å­—æ®µï¼š${missingFields.join(', ')}ï¼Œè·³è¿‡è¯¥æ–‡ä»¶`);
                  return null;
                }
                return questionData;
              } catch (e) {
                console.warn(`æ–‡ä»¶ ${file.name} JSONè§£æå¤±è´¥ï¼š${e.message}ï¼Œè·³è¿‡è¯¥æ–‡ä»¶`);
                return null;
              }
            });

            // 7. å¤„ç†åŠ è½½ç»“æœ
            const loadedQuestions = (await Promise.all(questionPromises)).filter(Boolean);
            if (loadedQuestions.length === 0) {
              throw new Error('æœªåŠ è½½åˆ°ä»»ä½•æœ‰æ•ˆæ ¼å¼çš„é¢˜ç›®æ–‡ä»¶ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶å†…å®¹æ˜¯å¦ç¬¦åˆè¦æ±‚');
            }

            // 8. æ›´æ–°é¢˜ç›®æ•°æ®
            questions.value = loadedQuestions;
            questionsLoaded.value = true;
            
            // 9. åˆå§‹åŒ–æŠ˜å çŠ¶æ€
            Object.keys(subjectCategories.value).forEach(key => {
              collapseStatus.value[key] = true;
            });

            // 10. ä¿å­˜é…ç½®å’ŒçŠ¶æ€
            saveGitHubConfig();
            saveCollapseStatus();
            
            successMsg.value = `æˆåŠŸåŠ è½½ ${loadedQuestions.length} é“é¢˜ç›®ï¼ˆå…±æ‰¾åˆ° ${jsonFiles.length} ä¸ªJSONæ–‡ä»¶ï¼Œ${jsonFiles.length - loadedQuestions.length} ä¸ªæ–‡ä»¶æ ¼å¼æ— æ•ˆï¼‰`;

          } catch (error) {
            errorMsg.value = error.message;
            console.error('åŠ è½½GitHubé¢˜åº“å¤±è´¥ï¼š', error);
          } finally {
            loading.value = false;
          }
        };

        // ========== è¾…åŠ©æ–¹æ³• ==========
        // é‡ç½®GitHubé…ç½®
        const resetConfig = () => {
          githubRepo.value = '';
          githubToken.value = '';
          githubPath.value = '';
          localStorage.removeItem(STORAGE_KEY.githubConfig);
          errorMsg.value = '';
          successMsg.value = '';
        };

        // è‡ªåŠ¨ç”ŸæˆäºŒçº§åˆ†ç±»ï¼šç§‘ç›®+å•å…ƒ
        const subjectCategories = computed(() => {
          const categories = {};
          questions.value.forEach(q => {
            if (!categories[q.cls]) {
              categories[q.cls] = new Set();
            }
            categories[q.cls].add(q.unit);
          });
          // è½¬æ¢ä¸ºæ•°ç»„
          Object.keys(categories).forEach(key => {
            categories[key] = Array.from(categories[key]);
          });
          return categories;
        });

        // ç­›é€‰å½“å‰åˆ†ç±»çš„é¢˜ç›®
        const filterQuestions = computed(() => {
          return questions.value.filter(q => {
            // ç§‘ç›®ç­›é€‰
            if (activeCategory.value !== 'all' && q.cls !== activeCategory.value) return false;
            // å•å…ƒç­›é€‰
            if (activeUnit.value !== 'all' && q.unit !== activeUnit.value) return false;
            return true;
          });
        });

        // å½“å‰ç­”é¢˜çš„é¢˜ç›®
        const currentQuestion = computed(() => {
          if (filterQuestions.value.length > 0 && currentQuestionIndex.value < filterQuestions.value.length) {
            return filterQuestions.value[currentQuestionIndex.value];
          }
          return null;
        });

        // å½“å‰åˆ†ç±»åç§°
        const activeCategoryName = computed(() => {
          if (activeCategory.value === 'all') return 'å…¨éƒ¨é¢˜ç›®';
          if (activeUnit.value === 'all') return activeCategory.value;
          return `${activeCategory.value}-${activeUnit.value}`;
        });

        // å½“å‰é¢˜ç›®æ˜¯å¦å·²æ”¶è—
        const isCollected = computed(() => {
          if (!currentQuestion.value) return false;
          return collectedQuestions.value.some(item => item.name === currentQuestion.value.name);
        });

        // ========== æœ¬åœ°å­˜å‚¨æ–¹æ³• ==========
        // ä¿å­˜åšé¢˜è¿›åº¦
        const saveProgress = () => {
          localStorage.setItem(STORAGE_KEY.progress, JSON.stringify({
            category: activeCategory.value,
            unit: activeUnit.value,
            index: currentQuestionIndex.value
          }));
        };

        // ä¿å­˜æ”¶è—é¢˜ç›®
        const saveCollected = () => {
          localStorage.setItem(STORAGE_KEY.collected, JSON.stringify(collectedQuestions.value));
        };

        // ä¿å­˜å®Œæˆçš„é¢˜ç›®
        const saveFinished = () => {
          localStorage.setItem(STORAGE_KEY.finished, JSON.stringify(finishedQuestionNames.value));
        };

        // ä¿å­˜æŠ˜å çŠ¶æ€
        const saveCollapseStatus = () => {
          localStorage.setItem(STORAGE_KEY.collapse, JSON.stringify(collapseStatus.value));
        };

        // ========== æ ¸å¿ƒä¸šåŠ¡æ–¹æ³• ==========
        // æå–é€‰é¡¹çš„å‰ç¼€ï¼ˆA/B/C/D/Eï¼‰
        const getOptionKey = (option) => {
          return option.charAt(0);
        };

        // åˆ¤æ–­é¢˜ç›®æ˜¯å¦å·²å®Œæˆ
        const isQuestionFinished = (name) => {
          return finishedQuestionNames.value.includes(name);
        };

        // åˆ¤æ–­é¢˜ç›®æ˜¯å¦å·²æ”¶è—
        const isQuestionCollected = (name) => {
          return collectedQuestions.value.some(item => item.name === name);
        };

        // æŠ˜å /å±•å¼€åˆ†ç±»
        const toggleCollapse = (key) => {
          collapseStatus.value[key] = !collapseStatus.value[key];
          if (collapseStatus.value[key] === false && activeCategory.value === key && activeUnit.value !== 'all') {
            switchCategory(key, 'all');
          }
          saveCollapseStatus();
        };

        // åˆ‡æ¢åˆ†ç±»ï¼ˆç§‘ç›®+å•å…ƒï¼‰
        const switchCategory = (category, unit = 'all') => {
          activeCategory.value = category;
          activeUnit.value = unit;
          currentQuestionIndex.value = 0;
          saveProgress();
          resetAnswerState();
          if (category !== 'all') {
            collapseStatus.value[category] = true;
            saveCollapseStatus();
          }
        };

        // ä»é¢˜ç›®åˆ—è¡¨è·³è½¬åˆ°æŒ‡å®šé¢˜ç›®
        const goToQuestion = (index) => {
          currentQuestionIndex.value = index;
          saveProgress();
          resetAnswerState();
        };

        // é‡ç½®ç­”é¢˜çŠ¶æ€
        const resetAnswerState = () => {
          selectedOption.value = null;
          showResult.value = false;
          isCorrect.value = null;
        };

        // æäº¤ç­”æ¡ˆ
        const submitAnswer = () => {
          if (!selectedOption.value || !currentQuestion.value) return;
          isCorrect.value = selectedOption.value === currentQuestion.value.answer;
          showResult.value = true;
          if (!finishedQuestionNames.value.includes(currentQuestion.value.name)) {
            finishedQuestionNames.value.push(currentQuestion.value.name);
            saveFinished();
          }
        };

        // ä¸‹ä¸€é¢˜
        const nextQuestion = () => {
          if (currentQuestionIndex.value >= filterQuestions.value.length - 1) return;
          currentQuestionIndex.value++;
          saveProgress();
          resetAnswerState();
        };

        // æ”¶è—/å–æ¶ˆæ”¶è—é¢˜ç›®
        const toggleCollect = () => {
          if (!currentQuestion.value) return;
          const index = collectedQuestions.value.findIndex(item => item.name === currentQuestion.value.name);
          if (index > -1) {
            collectedQuestions.value.splice(index, 1);
          } else {
            collectedQuestions.value.push({ ...currentQuestion.value });
          }
          saveCollected();
        };

        // é‡ç½®æ‰€æœ‰åšé¢˜è¿›åº¦
        const resetProgress = () => {
          activeCategory.value = 'all';
          activeUnit.value = 'all';
          currentQuestionIndex.value = 0;
          finishedQuestionNames.value = [];
          resetAnswerState();
          saveProgress();
          saveFinished();
        };

        // ========== æ”¶è—åˆ—è¡¨ç›¸å…³æ–¹æ³• ==========
        const showCollectList = () => {
          showCollectModal.value = true;
        };
        const closeCollectModal = () => {
          showCollectModal.value = false;
        };
        const goToCollectedQuestion = (question) => {
          activeCategory.value = question.cls;
          activeUnit.value = question.unit;
          const index = filterQuestions.value.findIndex(q => q.name === question.name);
          if (index > -1) currentQuestionIndex.value = index;
          saveProgress();
          resetAnswerState();
          closeCollectModal();
        };

        // ========== ç›‘å¬ä¸åˆå§‹åŒ– ==========
        // ç›‘å¬è¿›åº¦å˜åŒ–ï¼Œè‡ªåŠ¨ä¿å­˜
        watch([activeCategory, activeUnit, currentQuestionIndex], () => {
          saveProgress();
        });

        // ç›‘å¬æŠ˜å çŠ¶æ€å˜åŒ–ï¼Œè‡ªåŠ¨ä¿å­˜
        watch(collapseStatus, () => {
          saveCollapseStatus();
        }, { deep: true });

        // åˆå§‹åŒ–åŠ è½½æœ¬åœ°å­˜å‚¨æ•°æ®
        loadStorage();

        return {
          // GitHubé…ç½®ç›¸å…³
          githubRepo,
          githubToken,
          githubPath,
          loading,
          errorMsg,
          successMsg,
          questionsLoaded,
          loadQuestionsFromGitHub,
          resetConfig,
          
          // åˆ·é¢˜ç›¸å…³
          questions,
          subjectCategories,
          filterQuestions,
          currentQuestion,
          activeCategory,
          activeUnit,
          activeCategoryName,
          currentQuestionIndex,
          selectedOption,
          showResult,
          isCorrect,
          collectedQuestions,
          showCollectModal,
          isCollected,
          collapseStatus,
          
          // æ–¹æ³•
          getOptionKey,
          isQuestionFinished,
          isQuestionCollected,
          toggleCollapse,
          switchCategory,
          goToQuestion,
          submitAnswer,
          nextQuestion,
          toggleCollect,
          resetProgress,
          showCollectList,
          closeCollectModal,
          goToCollectedQuestion
        };
      },
    }).mount("#app");
  </script>
</body>
</html>